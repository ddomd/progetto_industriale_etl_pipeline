from facts.parse_data import parse_and_combine
from download_operations.download import download_list


def download_161_268():
    location_filters = {
        "liguria": "ITC3+ITC31+ITC32+ITC33+ITC34",
        "genova-1": "010001+010002+010003+010004+010005+010006+010007+010008+010009+010010+010011+010012+010013+010014+010015+010016+010017+010018+010019+010020+010021+010022+010023+010024+010025+010026+010027+010028+010029+010030+010031+010032+010033+010034+010035",
        "genova-2": "010036+010037+010038+010039+010040+010041+010042+010043+010044+010045+010046+010047+010048+010049+010050+010051+010052+010053+010054+010055+010056+010057+010058+010059+010060+010061+010062+010063+010064+010065",
        "savona-1": "009001+009002+009003+009004+009005+009006+009007+009008+009009+009010+009011+009012+009013+009014+009015+009016+009017+009018+009019+009020+009021+009022+009023+009024+009025+009026+009027+009028+009029+009030+009031+009032+009033+009034+009035",
        "savona-2": "009036+009037+009038+009039+009040+009041+009042+009043+009044+009045+009046+009047+009048+009049+009050+009051+009052+009053+009054+009055+009056+009057+009058+009059+009060+009061+009062+009063+009064+009065+009066+009067+009068+009069",
        "imperia-1": "008001+008002+008003+008004+008005+008006+008007+008008+008009+008010+008011+008012+008013+008014+008015+008016+008017+008018+008019+008020+008021+008022+008023+008024+008025+008026+008027+008028+008029+008031+008032+008033+008034+008035",
        "imperia-2": "008036+008037+008038+008039+008040+008041+008042+008043+008044+008045+008046+008047+008048+008049+008050+008051+008052+008053+008055+008056+008057+008058+008059+008060+008061+008062+008063+008064+008065",
        "laspezia-1": "011001+011002+011003+011004+011005+011006+011007+011008+011009+011010+011011+011012+011013+011014+011015+011016+011017+011018+011019+011020+011021+011022+011023+011024+011025+011026+011027+011028+011029+011030+011031+011032",
    }

    url_list = [
        f"https://esploradati.istat.it/SDMXWS/rest/data/IT1,161_268,1.0/.{locations}..55+56/ALL/?detail=full&startPeriod=2016-01-01"
        for locations in location_filters.values()
    ]

    print("- Downloading dataflow 161_268....")

    responses = download_list(url_list, headers={"Accept": "text/csv"})

    return responses


def parse_161_268(responses):
    to_drop = [
        "DATAFLOW",
        "OBS_STATUS",
        "NOTE_DS",
        "NOTE_REF_AREA",
        "NOTE_DATA_TYPE",
        "NOTE_ECON_ACTIVITY_NACE_2007",
        "NOTE_TIME_PERIOD",
        "BASE_PER",
        "UNIT_MEAS",
        "UNIT_MULT",
    ]

    return parse_and_combine(responses, to_drop)


def clean_161_268():
    return parse_161_268(download_161_268())
